<script>
const WGUSDT_ADDRESS = "0xfDb4190419F2b0453Dad7567dEF44E6AB07096c6";
const OOPS_ADDRESS   = "0xB0CBCcEe94c957Fa21A97551C825C4e71ADfF93D";
const ROUTER_ADDRESS = "0xe1aEe57F48830876B37A1a7d04d73eF9F1d069f2";

const DECIMALS = 18;

let provider, signer, userAddress;

// ================= CONNECT WALLET =================
const connectBtn = document.getElementById("connectBtn");
connectBtn.onclick = async () => {
  await window.ethereum.request({ method: "eth_requestAccounts" });
  provider = new ethers.providers.Web3Provider(window.ethereum);
  signer   = provider.getSigner();
  userAddress = await signer.getAddress();
  connectBtn.textContent = userAddress.slice(0,6)+"..."+userAddress.slice(-4);
  document.getElementById("swapBtn").disabled = false;
};

// ================= CONTRACT SETUP =================
const erc20ABI = [
  "function approve(address spender,uint256 amount) external returns(bool)"
];

const routerABI = [
  "function swapExactTokensForTokens(uint amountIn,uint amountOutMin,address[] calldata path,address to,uint deadline) external returns (uint[] memory amounts)"
];

let wgusdt, oops, router;

function loadContracts() {
  wgusdt = new ethers.Contract(WGUSDT_ADDRESS, erc20ABI, signer);
  oops   = new ethers.Contract(OOPS_ADDRESS,   erc20ABI, signer);
  router = new ethers.Contract(ROUTER_ADDRESS, routerABI, signer);
}

// ================= REAL SWAP LOGIC =================
const swapBtn = document.getElementById("swapBtn");
swapBtn.onclick = async () => {
  const status = document.getElementById("status");

  try {
    loadContracts();

    const amountInStr = document.getElementById("swapInput").value.trim();
    if (!amountInStr || Number(amountInStr) <= 0) {
      status.textContent = "Enter amount first.";
      return;
    }

    const amountIn = ethers.utils.parseUnits(amountInStr, DECIMALS);

    status.textContent = "â³ Approving wGUSDT...";
    const tx1 = await wgusdt.approve(ROUTER_ADDRESS, amountIn);
    await tx1.wait();

    status.textContent = "ðŸ”¥ Swapping...";
    const path = [WGUSDT_ADDRESS, OOPS_ADDRESS];

    const tx2 = await router.swapExactTokensForTokens(
      amountIn,
      0,
      path,
      userAddress,
      Math.floor(Date.now()/1000) + 600
    );

    status.textContent = "â³ Tx: " + tx2.hash;
    await tx2.wait();

    status.textContent = "âœ… Swap success!";
  } catch(e){
    status.textContent = "âŒ Error: " + (e.reason || e.message);
    console.error(e);
  }
};

// =============== ADD LP (TETAP ADA) ===============
const addLpBtn = document.getElementById("addLpBtn");
addLpBtn.onclick = async () => {
  document.getElementById("lpStatus").textContent = "âœ… Phase 2 nanti.";
};
</script>
